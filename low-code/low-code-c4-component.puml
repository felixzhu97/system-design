@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title 低代码平台 - 应用引擎组件图 (C4 Level 3)

LAYOUT_WITH_LEGEND()

Person(endUser, "最终用户", "使用低代码生成的应用")
Container_Ext(webPortal, "Web门户", "React", "管理后台界面")
Container_Ext(apiGateway, "API网关", "Spring Cloud Gateway", "API路由和认证")

Container_Boundary(c1, "应用引擎") {
    Component(authController, "认证控制器", "Spring Security", "用户身份验证和授权")
    Component(formController, "表单控制器", "Spring MVC", "动态表单渲染和提交")
    Component(dataController, "数据控制器", "Spring MVC", "数据CRUD操作接口")
    Component(reportController, "报表控制器", "Spring MVC", "报表查询和导出")
    Component(workflowController, "流程控制器", "Spring MVC", "工作流操作接口")
    
    Component(formService, "表单服务", "Spring Service", "表单配置解析和渲染")
    Component(dataService, "数据服务", "Spring Service", "动态数据模型操作")
    Component(validationService, "验证服务", "Hibernate Validator", "数据验证和业务规则")
    Component(permissionService, "权限服务", "Spring Security", "细粒度权限控制")
    Component(reportService, "报表服务", "JasperReports", "报表生成和导出")
    Component(notificationService, "通知服务", "Spring Service", "消息通知处理")
    
    Component(formRenderer, "表单渲染器", "Template Engine", "动态表单HTML生成")
    Component(dataMapper, "数据映射器", "MyBatis-Plus", "ORM数据访问层")
    Component(cacheManager, "缓存管理器", "Spring Cache", "数据缓存和会话管理")
    Component(fileHandler, "文件处理器", "Apache Commons", "文件上传下载处理")
    Component(auditLogger, "审计日志", "Spring AOP", "操作日志记录")
    Component(configManager, "配置管理器", "Spring Configuration", "应用配置动态加载")
}

ComponentDb(platformDb, "平台数据库", "MySQL", "应用配置和元数据")
ComponentDb(businessDb, "业务数据库", "MySQL", "应用业务数据")
Component_Ext(redis, "Redis缓存", "Redis", "缓存和会话存储")
Component_Ext(workflowEngine, "工作流引擎", "Activiti", "业务流程执行")
Component_Ext(fileStorage, "文件存储", "MinIO", "文件存储服务")

Rel(endUser, authController, "登录认证", "HTTPS/JSON")
Rel(endUser, formController, "表单操作", "HTTPS/JSON")
Rel(endUser, dataController, "数据操作", "HTTPS/JSON")
Rel(endUser, reportController, "报表查询", "HTTPS/JSON")

Rel(webPortal, authController, "管理界面", "HTTPS/JSON")
Rel(apiGateway, authController, "API路由", "HTTP/JSON")
Rel(apiGateway, formController, "API路由", "HTTP/JSON")
Rel(apiGateway, dataController, "API路由", "HTTP/JSON")

Rel(authController, permissionService, "权限验证", "Java调用")
Rel(formController, formService, "表单处理", "Java调用")
Rel(dataController, dataService, "数据处理", "Java调用")
Rel(reportController, reportService, "报表生成", "Java调用")
Rel(workflowController, workflowEngine, "流程执行", "Java调用")

Rel(formService, formRenderer, "渲染表单", "Java调用")
Rel(formService, configManager, "读取配置", "Java调用")
Rel(dataService, dataMapper, "数据访问", "Java调用")
Rel(dataService, validationService, "数据验证", "Java调用")
Rel(dataService, auditLogger, "记录日志", "Java调用")

Rel(formRenderer, cacheManager, "缓存模板", "Java调用")
Rel(dataMapper, platformDb, "读写配置", "JDBC/SQL")
Rel(dataMapper, businessDb, "读写数据", "JDBC/SQL")
Rel(cacheManager, redis, "缓存操作", "Redis Protocol")

Rel(reportService, dataService, "查询数据", "Java调用")
Rel(notificationService, workflowEngine, "流程通知", "Java调用")
Rel(fileHandler, fileStorage, "文件操作", "HTTP/API")

Rel(permissionService, cacheManager, "权限缓存", "Java调用")
Rel(validationService, configManager, "验证规则", "Java调用")

@enduml 